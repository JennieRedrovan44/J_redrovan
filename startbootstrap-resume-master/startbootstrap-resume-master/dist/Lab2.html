<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>Jennie Redrovan</title>
        <link rel="icon" type="image/x-icon" href="assets/img/favicon.ico" />
        <!-- Font Awesome icons (free version)-->
        <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
        <!-- Google fonts-->
        <link href="https://fonts.googleapis.com/css?family=Saira+Extra+Condensed:500,700" rel="stylesheet" type="text/css" />
        <link href="https://fonts.googleapis.com/css?family=Muli:400,400i,800,800i" rel="stylesheet" type="text/css" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="css/styles.css" rel="stylesheet" />
    </head>
    <body id="page-top">
        <!-- Navigation-->
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top" id="sideNav">
            <a class="navbar-brand js-scroll-trigger" href="#about">
                <span class="d-block d-lg-none">Jennie Redrovan</span>
                <span class="d-none d-lg-block">
                    <img class="img-fluid img-profile rounded-circle mx-auto mb-2" src="assets/img/Picofme.png" alt="Profile Picture" />
                </span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="index.html">About</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="Lab1A.html">Lab 1A: Artemis</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="Lab1B.html">Lab 1B: Bluetooth</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="Lab2.html" style="color: rgb(255, 255, 255);">Lab 2: IMU</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="Lab3.html">Lab 3: TOF</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="Lab4.html">Lab 4: Motor Drivers, Open Loop Control</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="Lab5.html">Lab 5: Speed Control</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="Lab6.html">Lab 6: Orientation Control</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="Lab7.html">Lab 7: Kalman Filter</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="Lab8.html">Lab 8: Stunts!</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="Lab9.html">Lab 9: Mapping</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="Lab10.html">Lab 10: Bayes Filter (Sim)</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="Lab11.html">Lab 11: Localization (Real)</a></li>
                    <li class="nav-item"><a class="nav-link js-scroll-trigger" href="Lab12.html">Lab 12: Path Planning</a></li>
                </ul>
            </div>
        </nav>
        <!-- Page Content-->
        <section class="resume-section" id="about">
            <div class="resume-section-content">
                <h2 class="mb-2">Lab 2 : <span class="text-primary">IMU</span></h2>
                <!--Prelab-->
                <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
                    <div class="flex-grow-1">
                        <h3 class="mb-0">Prelab</h3>
                        <p>
                            For the Prelab, I read on IMU on its functionality and its datasheet.
                        </p>
                    </div>
                </div>

        <!--Tasks for Lab 2-->
        <div class="d-flex flex-column flex-md-row justify-content-between mb-5">
            <div class="flex-grow-1">
                
                <h3 class="mb-0">Task 1 : Set up the IMU</h3>
                <p> 
                    1. I installed the SparkFun 9DOF IMU Breakout_ICM 20948_Arduino Library into the Arduino IDE. 
                </p>
                <p>
                    2. Artemis IMU connections:
                </p>
                <p>
                    <img src="assets/img_lab2/set_up_connection.png" alt = "set_up_connection" width=90% />
                </p>
                <p>
                    As seen above, I connected my Artemis to the IMU board QWIIC connectors. I connected to the I2C port of the IMU board.
                </p>
                <p>
                    3. IMU example code works
                </p>
                <body>
                    <iframe
                        width="560"
                        height="315"
                        src="https://www.youtube.com/embed/6u1Vur823zc"
                        title="YouTube video player"
                        frameborder="0"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                        allowfullscreen>
                    </iframe>
                </body>
                <body>
                    <iframe
                        width="560"
                        height="315"
                        src="https://www.youtube.com/embed/3hvMik6"
                        title="YouTube video player"
                        frameborder="0"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                        allowfullscreen>
                    </iframe>
                </body>
                <p>
                    As shown above, the IMU example code works. The IMU board is able to read the acceleration and gyroscope data.
                    How I did was, I ran the code and decreased the baud to 9600 to be able to see the data more easily. 
                </p>
                <p> 
                    3a. AD0_VAL definition. What does it represent, and should it be 0 or 1?
                </p>
                <p>
                    The AD0_VAL represents the last but of the I2C address. It should be 0 since the ADR jumper is closed; however, this depents on wheater the ADR jumper is open or closed for it be either 0 or 1.
                </p>
                <p>
                    3b. Explanation of what I see in both acceleration and gyroscope data
                </p>
                <p>
                    As I moved the IMU board, I noticed that when I moved the IMU in the positive direction 
                    of the respective axis, the accelerometer increase in value. When I moved the IMU in the 
                    negative direction of the respective axis, the accelerometer decrease in value and became 
                    negative. Also, for the gyroscope, I noticed when I did the pitch, roll, and yaw, it also 
                    changed in value.  
                </p>

                <p>
                    5. Video of the Arthemis blinking

                </p>
                <body>
                    <iframe
                        width="560"
                        height="315"
                        src="https://www.youtube.com/embed/DyjrG7W4yVg"
                        title="YouTube video player"
                        frameborder="0"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                        allowfullscreen>
                    </iframe>
                </body>
                <p>
                    How I was able to add the blinking LED was to add the following code:
                    </p>
                    <p>
                    digitalWrite(LED_BUILTIN, HIGH);  // turn the LED on (HIGH is the voltage level)
                    delay(1000);                      // wait for a second
                    digitalWrite(LED_BUILTIN, LOW);   // turn the LED off by making the voltage LOW
                    delay(1000);                      // wait for a second
                    digitalWrite(LED_BUILTIN, HIGH);  // turn the LED on (HIGH is the voltage level)
                    delay(1000);                      // wait for a second
                    digitalWrite(LED_BUILTIN, LOW);   // turn the LED off by making the voltage LOW
                    delay(1000);         
                    digitalWrite(LED_BUILTIN, HIGH);  // turn the LED on (HIGH is the voltage level)
                    delay(1000);                      // wait for a second
                    digitalWrite(LED_BUILTIN, LOW);   // turn the LED off by making the voltage LOW
                    delay(1000);      
                </p>
                <p>
                    I added the code above to the void setup() function. 
                </p>
                
                <h3 class="mb-0">Task 2 : Accelerometer</h3>
                <p>
                    The accelerometer is measured in the X, Y, and Z axis. Using the geometry 
                    and the conversions used in class, I was able to calculate the pitch and roll as shown below:
                </p>
                <p>
                1. Equations for Pitch and Roll
                </p>
                <p>
                    pitch_a = atan2(myICM.accX(),myICM.accZ())*180/M_PI; 
                    roll_a  = atan2(myICM.accY(),myICM.accZ())*180/M_PI; 
                </p>
                <p>
                    1a. Output at {-90, 0, 90} degrees for pitch and roll 
                </p>
                <body>
                    <iframe
                        width="560"
                        height="315"
                        src="https://www.youtube.com/embed/Za70EGz3A"
                        title="YouTube video player"
                        frameborder="0"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                        allowfullscreen>
                    </iframe>
                </body>
                <p>
                    As shown above, I was able to output the pitch and roll. I commented out some of the code like the gyroscope data to be able to 
                    see only the pitch and roll. From here, I was able to move the IMU board so that it can output 
                    -90 for pitch and for roll +90. However, there was slight human error 
                    becuase I had to move it slighlty to be able to get it accurate. 
                </p>
                <p>
                    1b. How accurate is your accelerometer?
                </p>
                <p>
                    For the plots below, I was able to get the following values for pitch and roll by essentially adding the code from Lecture 4 into the BLE_arduino code.
                    From there I added a case, SEND_PITCH_ROLL, which would send the pitch, roll, and time values to jupyter notebook. In the jupyter notebook, I was able to plot the pitch and roll values by breaking the 
                    string into a list and then plotting the values.
                </p>
                <p>
                    Code for case SEND_PITCH_ROLL:
                </p>
                <p>
                    Serial.println( "I started"); 
                    for ( i = 0; i < 500; i++) {
            
                    if(myICM.dataReady())
                    {
                      myICM.getAGMT();                // The values are only updated when you call 'getAGMT
                    }
                      pitch_array[i] = atan2(myICM.accX(),myICM.accZ())*180/M_PI; 
                      roll_array[i] =  atan2(myICM.accY(),myICM.accZ())*180/M_PI;  
                      time_array[i] = (float) millis();
            
                      /*
                      //NB: Setup Serialplot Y axis [-180 180]
                      Serial.print("lower_limit:");
                      Serial.print(-200);
                      Serial.print(", upper_limit:");
                      Serial.print(200);
                      */
                      pitch_a = atan2(myICM.accX(),myICM.accZ())*180/M_PI; 
                      roll_a  = atan2(myICM.accY(),myICM.accZ())*180/M_PI; 
                      Serial.print("pitch_a:");
                      Serial.print(pitch_a);
                      Serial.print("| roll_a:");
                      Serial.println(roll_a);
                      // Serial.print("| time (ms)");
                      // Serial.println((float) millis());
            
                      delay(100);
            
                      //Serial.println(roll_a); //FOR THE SECOND DEMO, COMMENT OUT LINE FOR THIRD DEMO
                      //Serial.print(roll_a); //FOR THE THIRD DEMO, COMMENT OUT LINE FOR SECOND DEMO
                    }
                    
                    for ( j = 0; j < 500; j++) {
                      tx_estring_value.clear();
                      tx_estring_value.append("PITCH: ");
                      tx_estring_value.append(pitch_array[j]);
                      tx_estring_value.append(" | ");
                      tx_estring_value.append("ROLL: ");
                      tx_estring_value.append(roll_array[j]);
                      tx_estring_value.append(" | ");
                      tx_estring_value.append("time: ");
                      tx_estring_value.append(time_array[j]);
                      tx_characteristic_string.writeValue(tx_estring_value.c_str());
                    }
            
            
                    Serial.println("IT WORKED YAYAYAYY!");
            
            
                    break;
                </p>
                <p>
                    Jupyter Notebook Code:
                </p>
                <p>
                    time = np.array(time, dtype=float)

mean_pitch=np.sum(pitch)/len(pitch)
mean_roll=np.sum(roll)/len(roll)
#print(f' Mean Pitch = {mean_pitch}') 
print(f' Mean Roll = {mean_roll}')

stdev_pitch = statistics.stdev(pitch)
stdev_roll = statistics.stdev(roll)
#print(f' Stdev Pitch = {stdev_pitch}') 
print(f' Stdev Roll = {stdev_roll}') 

# Plotting
plt.figure(figsize=(8, 6))
#plt.plot(time, pitch, 'r-', label='Pitch (-90 deg)')
plt.plot(time, roll, 'b-', label='Roll (-90 deg)')

plt.xlabel('Time (ms)')
plt.ylabel('Amplitude (degree)')
plt.legend(loc='right')

plt.xticks(rotation=45)  # Rotate x-axis labels
plt.locator_params(axis='x', nbins=10)  # Reduce number of x-axis ticks

plt.show()

                </p>
                <p>
                    <img src="assets/img_lab2/accelerometer_pitchandroll_0deg.png" alt = "accelerometer_pitchandroll_0deg" width=90% />
                </p>
                <p>
                    <img src="assets/img_lab2/accelerometer_pitch_n90.png" alt = "accelerometer_pitch_n90" width=90% />
                </p>
                <p>
                    <img src="assets/img_lab2/accelerometer_roll_n90.png" alt = "accelerometer_roll_n90" width=90% />
                </p>
                <p>
                    In the images above, the accelerometer is not super accurate, but it is close to the actual value. The values 
                    are not too far off from the expected value as calculated from the standard. However, there is a slight
                    chance when I was holding the IMU board, I might have tilted a little bit, which could have caused the slight difference in the
                    measured value and the actual value.
                </p>

                <p>
                    2. Fourier Transform of accelerometer data without noise 
                </p>
                <p>
                    <img src="assets/img_lab2/accelerometer_pitchandroll_0deg_fourier.png" alt = "accelerometer_fourier" width=90% />
                </p>

                <p>
                    Fourier Transform of accelerometer data with noise 
                </p>
                <p>
                    <img src="assets/img_lab2/accelerometer_pitchandroll_0deg_fourier_noise.png" alt = "accelerometer_fourier" width=90% />
                </p>
                <p>
                    Here, I applied the Fourier Transform to the accelerometer data. I followed the process given by the article and applied it. 
                </p>
                <p>
                Serial.println( "I started FOURIER"); 
                unsigned long start_time_FFT=millis();

                i=0;

        while ((millis()-start_time_FFT)<10000){
          
          if(myICM.dataReady())
          {
            myICM.getAGMT();                // The values are only updated when you call 'getAGMT
          }

          Serial.println(i); 
          if (i < 1000) {  // Prevent array overflow
            //Serial.println( "loop is working for i<500"); 
            pitch_a = atan2(myICM.accX(),myICM.accZ())*180/M_PI; 
            roll_a  = atan2(myICM.accY(),myICM.accZ())*180/M_PI; 
            pitch_array[i] = pitch_a;
            roll_array[i] = roll_a;
            time_array[i] = (float)((millis() - start_time_FFT));
            i++;
            delay(6);
          }

          if ((millis()-start_time_FFT)>=5000){
            Serial.println("turn right now");
          }
          
        }
        for ( i = 0; i < 1000; i++) {
          Serial.println( "SENDING STRING"); 
          tx_estring_value.clear();
          tx_estring_value.append("PITCH: ");
          tx_estring_value.append(pitch_array[i]);
          tx_estring_value.append(" | ");
          tx_estring_value.append("ROLL: ");
          tx_estring_value.append(roll_array[i]);
          tx_estring_value.append(" | ");
          tx_estring_value.append("time: ");
          tx_estring_value.append(time_array[i]);
          tx_characteristic_string.writeValue(tx_estring_value.c_str());
        }
        Serial.println("IT WORKED YAYAYAYY FOR FOURIER!");
        break;
      }
                </p>
                <p>
                    A good cutoff frequency is 10 Hz given that the bigger spikes occur near 0hz.
                </p>
                <h4 class="mb-0">Applying Low Pass Filter</h3>
                <p>
                    <img src="assets/img_lab2/accelerometer_Low_pass_alpha_.38.png" alt = "accelerometer_fourier" width=90% />
                </p>
                    
                




            </div>












            </section>
        </div>
        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <script src="js/scripts.js"></script>
    </body>
</html>
